--- pytz-2010l/pytz/__init__.py	2010-11-19 12:30:02.768226674 +0200
+++ pytz-2010l.new/pytz/__init__.py	2010-11-19 12:28:59.587810671 +0200
@@ -43,24 +43,19 @@
 except NameError:
     from sets import Set as set
 
+_tzinfo_dir = os.getenv("TZDIR") or "/usr/share/zoneinfo"
+if _tzinfo_dir.endswith(os.sep):
+    _tzinfo_dir = _tzinfo_dir[:-1]
 
 def open_resource(name):
     """Open a resource from the zoneinfo subdir for reading.
 
-    Uses the pkg_resources module if available and no standard file
-    found at the calculated location.
     """
     name_parts = name.lstrip('/').split('/')
     for part in name_parts:
         if part == os.path.pardir or os.path.sep in part:
             raise ValueError('Bad path segment: %r' % part)
-    filename = os.path.join(os.path.dirname(__file__),
-                            'zoneinfo', *name_parts)
-    if not os.path.exists(filename) and resource_stream is not None:
-        # http://bugs.launchpad.net/bugs/383171 - we avoid using this
-        # unless absolutely necessary to help when a broken version of
-        # pkg_resources is installed.
-        return resource_stream(__name__, 'zoneinfo/' + name)
+    filename = os.path.join(_tzinfo_dir, *name_parts)
     return open(filename, 'rb')
 
 
@@ -453,12 +448,30 @@
 if __name__ == '__main__':
     _test()
 
- 'Zulu']
-all_timezones = [
-        tz for tz in all_timezones if resource_exists(tz)]
+all_timezones = []
+for root, dirs, files in os.walk(_tzinfo_dir):
+    for exclude in "posix", "right":
+        if exclude in dirs:
+            del dirs[dirs.index(exclude)]
+
+    all_timezones.extend(os.path.join(root, file)[len(_tzinfo_dir)+1:]
+                         for file in files
+                         if file != "README" and file != "Theory"
+                         and "." not in file)
+all_timezones.sort()
         
 all_timezones_set = set(all_timezones)
-common_timezones = [
-        tz for tz in common_timezones if tz in all_timezones]
-        
+common_timezones = [l.split()[2]
+                    for l in open(os.path.join(_tzinfo_dir, "zone.tab"))
+                    if l != "" and l[0] != "#"]\
+  + ['GMT',
+     'US/Alaska',
+     'US/Arizona',
+     'US/Central',
+     'US/Eastern',
+     'US/Hawaii',
+     'US/Mountain',
+     'US/Pacific',
+     'UTC']
+common_timezones.sort()
 common_timezones_set = set(common_timezones)
